# Copyright (c) HashiCorp, Inc.
# SPDX-License-Identifier: MPL-2.0

suite: Create a Service
templates:
  - service.yaml
release:
  name: this
  namespace: default
tests:
  - it: Should Create a Service
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: Service
      - equal:
          path: metadata.name
          value: this-controller-manager-metrics-service
      - equal:
          path: metadata.namespace
          value: default
      - notExists:
          path: metadata.annotations
      - exists:
          path: metadata.labels
      - isNotNullOrEmpty:
          path: metadata.labels
      - equal:
          path: metadata.labels
          value:
            control-plane: this-controller-manager
      - exists:
          path: spec.ports
      - isNotNullOrEmpty:
          path: spec.ports
      - lengthEqual:
          path: spec.ports
          count: 1
      - equal:
          path: spec.ports
          value:          
          - name: https
            port: 8443
            protocol: TCP
            targetPort: https
      - exists:
          path: spec.selector
      - isNotNullOrEmpty:
          path: spec.selector
      - equal:
          path: spec.selector
          value:
            control-plane: this-controller-manager
---
suite: Create a Service in a Custom Namespace
templates:
  - service.yaml
release:
  name: this
  namespace: this
tests:
  - it: Should Create a Service in a Custom Namespace
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: Service
      - equal:
          path: metadata.name
          value: this-controller-manager-metrics-service
      - equal:
          path: metadata.namespace
          value: this
      - notExists:
          path: metadata.annotations
      - exists:
          path: metadata.labels
      - isNotNullOrEmpty:
          path: metadata.labels
      - equal:
          path: metadata.labels
          value:
            control-plane: this-controller-manager
      - exists:
          path: spec.ports
      - isNotNullOrEmpty:
          path: spec.ports
      - lengthEqual:
          path: spec.ports
          count: 1
      - equal:
          path: spec.ports
          value:          
          - name: https
            port: 8443
            protocol: TCP
            targetPort: https
      - exists:
          path: spec.selector
      - isNotNullOrEmpty:
          path: spec.selector
      - equal:
          path: spec.selector
          value:
            control-plane: this-controller-manager
